---
- name: Install openvpn
  apt: name={{item}} state=present
  with_items:
    - openvpn
- name: Copy keys files
  copy: src={{item}} dest=/etc/openvpn/{{item}}
  with_items:
    - ca.crt
    - ca.key
    - dh2048.pem
    - server.crt
    - server.key
- name: Create ta.key
  command: openvpn --genkey --secret /etc/openvpn/ta.key
- name: Fethc ta.key
  fetch:
    src: /etc/openvpn/ta.key
    dest: /home/markovnin/openvpn/openvpn-ca/keys/ta.key
    flat: yes
- name: Configure openvpn
  template:
    src: server.conf
    dest: /etc/openvpn/server.conf
  notify:
    - restart openvpn
